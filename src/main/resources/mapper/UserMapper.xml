<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zazhi.mapper.UserMapper">
    <resultMap id="rolePermissionMap" type="com.zazhi.pojo.RoleAndPermission">
        <id property="userId" column="user_id"/>
        <collection property="roles" ofType="java.lang.String">
            <result column="role_name"/>
        </collection>
        <collection property="permissions" ofType="java.lang.String">
            <result column="permission_name"/>
        </collection>
    </resultMap>
    <select id="getRolesAndPermissions" resultMap="rolePermissionMap">
        SELECT
            u.id AS user_id,
            r.name AS role_name,
            p.name AS permission_name
        FROM user u
                 LEFT JOIN user_role ur ON u.id = ur.user_id
                 LEFT JOIN role r ON ur.role_id = r.id
                 LEFT JOIN role_permission rp ON r.id = rp.role_id
                 LEFT JOIN permission p ON rp.permission_id = p.id
        WHERE u.id = #{userId}
    </select>
</mapper>
